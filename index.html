<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××™×“×¢ ×¨×›×‘</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .search-section {
            padding: 30px;
            background: #f8f9fa;
        }
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .search-box input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }
        .search-box button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .loading .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .results {
            padding: 30px;
        }
        .vehicle-card {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-right: 5px solid #3498db;
        }
        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        .vehicle-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .vehicle-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-right: 3px solid #3498db;
        }
        .info-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .info-value {
            color: #34495e;
            font-size: 1.1em;
        }
        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .key-info-section {
            background: #e6f7ff; /* Light blue background for emphasis */
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 2px solid #a0daff;
        }
        .key-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .key-info-item {
            background: #ffffff;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff; /* Blue accent bar */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .key-info-label {
            font-weight: bold;
            color: #0056b3;
            font-size: 0.9em;
            margin-bottom: 3px;
        }
        .key-info-value {
            color: #333;
            font-size: 1.2em;
            font-weight: 600;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-right: 5px solid #dc3545;
        }
        .history-item {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-right: 3px solid #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .api-info {
            background: #e7f3ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 5px solid #007bff;
        }
        .api-info h3 {
            margin-top: 0;
            color: #0056b3;
        }
        .resource-list {
            list-style: none;
            padding: 0;
        }
        .resource-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .resource-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— ×‘×“×™×§×ª ××™×“×¢ ×¨×›×‘</h1>
            <p>××¢×¨×›×ª ×œ×‘×“×™×§×ª ××™×“×¢ ×¨×›×‘ ×-data.gov.il</p>
        </div>
        
        <div class="search-section">
            <div class="api-info">
                <h3>××©××‘×™ ××™×“×¢ ×–××™× ×™×:</h3>
                <ul class="resource-list">
                    <li><strong>×¨×›×‘×™× ×¤×¨×˜×™×™× ×•××¡×—×¨×™×™×:</strong> × ×ª×•× ×™× ×‘×¡×™×¡×™×™× ×¢×œ ×”×¨×›×‘ (×™×¦×¨×Ÿ, ×“×’×, ×©× ×ª ×™×™×¦×•×¨, ×¦×‘×¢, ×‘×“×™×§×” ××—×¨×•× ×”)</li>
                    <li><strong>×ª×•×•×™ × ×›×•×ª:</strong> ××™×“×¢ ×¢×œ ×”× ×¤×§×ª ×ª×•×•×™ × ×›×•×ª ×œ×¨×›×‘</li>
                    <li><strong>×”×™×¡×˜×•×¨×™×™×ª ××‘×—× ×™×:</strong> ××™×“×¢ ×¢×œ ×§×™×œ×•××˜×¨ ×œ××‘×—×Ÿ ××—×¨×•×Ÿ ×•×©×™× ×•×™×™×</li>
                    <li><strong>××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘:</strong> × ×ª×•× ×™× ×˜×›× ×™×™× × ×•×¡×¤×™× ×œ×¤×™ ×“×’×, ×©× ×ª ×™×™×¦×•×¨ ×•×¨××ª ×’×™××•×¨</li>
                    <li><strong>×”×™×¡×˜×•×¨×™×™×ª ×‘×¢×œ×•×™×•×ª:</strong> × ×ª×•× ×™× ×¢×œ ×©×™× ×•×™×™× ×‘×‘×¢×œ×•×ª ×”×¨×›×‘</li>
                </ul>
            </div>
            
            <div class="search-box">
                <input type="number" id="vehicleNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×¨×›×‘ (×œ×“×•×’××”: 8767873)" min="1" max="99999999">
                <button onclick="searchVehicle()">ğŸ” ×—×¤×©</button>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>××—×¤×© ××™×“×¢ ×¢×œ ×”×¨×›×‘...</p>
        </div>

        <div id="results" class="results"></div>
    </div>

    <script>
        // ××©××‘×™ API ×©×•× ×™×
        const API_RESOURCES = {
            vehicles: '053cea08-09bc-40ec-8f7a-156f0677aff3',
            disability_tags: 'c8b9f9c8-4612-4068-934f-d4acd2e3c06e',
            test_history: '56063a99-8a3e-4ff4-912e-5966c0279bad',
            ownership_history: 'bb2355dc-9ec7-4f06-9c3f-3344672171da',
            // resource ID ×¢×‘×•×¨ ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘, ×›×¤×™ ×©×¦×•×™×Ÿ ×‘×“×•×’××”
            detailed_technical_specs: '142afde2-6228-49f9-8a29-9b6c3a0cbe40'
        };

        // ×¤×•× ×§×¦×™×” ×œ×§×¨×™××ª × ×ª×•× ×™× ××”-API
        async function fetchVehicleData(resourceId, query) {
            try {
                let url = `https://data.gov.il/api/3/action/datastore_search?resource_id=${resourceId}`;
                // ×× ×”×§×•×•××¨×™ ×”×•× ××•×‘×™×™×§×˜ (×œ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘), × ×§×•×“×“ ××•×ª×•
                if (typeof query === 'object' && query !== null) {
                    url += `&q=${encodeURIComponent(JSON.stringify(query))}`;
                } else {
                    url += `&q=${encodeURIComponent(query)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    return data.result.records || [];
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                return [];
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ×ª××¨×™×š
        function formatDate(dateString) {
            if (!dateString) return ''; // Changed to empty string for conditional display
            
            // ×× ×–×” ×ª××¨×™×š ×‘×¤×•×¨××˜ YYYYMMDD
            if (dateString.toString().length === 8) {
                const year = dateString.toString().substring(0, 4);
                const month = dateString.toString().substring(4, 6);
                const day = dateString.toString().substring(6, 8);
                return `${day}/${month}/${year}`;
            }
            
            // ×× ×–×” ×ª××¨×™×š ×‘×¤×•×¨××˜ YYYY-MM-DD
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                return `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            
            return String(dateString); // Ensure it's a string
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ×ª×•×¦××•×ª ×”×¨×›×‘ ×”×‘×¡×™×¡×™×•×ª
        function formatVehicleInfo(vehicle) {
            const isActive = vehicle.tokef_dt && new Date(vehicle.tokef_dt) > new Date();
            
            return `
                <div class="vehicle-card">
                    <div class="vehicle-header">
                        <div class="vehicle-number">${vehicle.mispar_rechev}</div>
                        <div class="vehicle-status ${isActive ? 'status-active' : 'status-inactive'}">
                            ${isActive ? '×¨×›×‘ ×‘×ª×•×§×£' : '×¨×›×‘ ×œ× ×‘×ª×•×§×£'}
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">×™×¦×¨×Ÿ</div>
                            <div class="info-value">${vehicle.tozeret_nm || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×“×’×</div>
                            <div class="info-value">${vehicle.degem_nm || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×©× ×ª ×™×™×¦×•×¨</div>
                            <div class="info-value">${vehicle.shnat_yitzur || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¦×‘×¢</div>
                            <div class="info-value">${vehicle.tzeva_rechev || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¡×•×’ ×“×œ×§</div>
                            <div class="info-value">${vehicle.sug_delek_nm || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×‘×¢×œ×•×ª</div>
                            <div class="info-value">${vehicle.baalut || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">××‘×—×Ÿ ××—×¨×•×Ÿ</div>
                            <div class="info-value">${formatDate(vehicle.mivchan_acharon_dt) || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×ª×•×§×£ ×¨×™×©×™×•×Ÿ</div>
                            <div class="info-value">${formatDate(vehicle.tokef_dt) || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¢×œ×™×” ×œ×›×‘×™×©</div>
                            <div class="info-value">${vehicle.moed_aliya_lakvish || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">××¡×¤×¨ ××¡×’×¨×ª</div>
                            <div class="info-value">${vehicle.misgeret || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¦××™×’×™× ×§×“××™×™×</div>
                            <div class="info-value">${vehicle.zmig_kidmi || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¦××™×’×™× ××—×•×¨×™×™×</div>
                            <div class="info-value">${vehicle.zmig_ahori || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ××™×“×¢ ×¢×œ ×ª×•×•×™ × ×›×•×ª
        function formatDisabilityTags(tags) {
            if (!tags || tags.length === 0) {
                return '<div class="no-data">××™×Ÿ ××™×“×¢ ×¢×œ ×ª×•×•×™ × ×›×•×ª</div>';
            }

            return tags.map(tag => `
                <div class="history-item">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">×ª××¨×™×š ×”× ×¤×§×ª ×ª×•</div>
                            <div class="info-value">${formatDate(tag['TAARICH HAFAKAT TAG']) || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¡×•×’ ×ª×•</div>
                            <div class="info-value">${tag['SUG TAV'] || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ×”×™×¡×˜×•×¨×™×™×ª ××‘×—× ×™×
        function formatTestHistory(history) {
            if (!history || history.length === 0) {
                return '<div class="no-data">××™×Ÿ ××™×“×¢ ×¢×œ ×”×™×¡×˜×•×¨×™×™×ª ××‘×—× ×™×</div>';
            }

            return history.map(test => `
                <div class="history-item">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">×§×™×œ×•××˜×¨ ×‘××‘×—×Ÿ ××—×¨×•×Ÿ</div>
                            <div class="info-value">${test.kilometer_test_aharon ? test.kilometer_test_aharon.toLocaleString() : '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×©×™× ×•×™ ××‘× ×”</div>
                            <div class="info-value">${test.shinui_mivne_ind ? '×›×Ÿ' : '×œ×'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×’×–×™ ×¤×œ×™×˜×”</div>
                            <div class="info-value">${test.gapam_ind ? '×›×Ÿ' : '×œ×'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×©×™× ×•×™ ×¦×‘×¢</div>
                            <div class="info-value">${test.shnui_zeva_ind ? '×›×Ÿ' : '×œ×'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×©×™× ×•×™ ×¦××™×’×™×</div>
                            <div class="info-value">${test.shinui_zmig_ind ? '×›×Ÿ' : '×œ×'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">×¨×™×©×•× ×¨××©×•×Ÿ</div>
                            <div class="info-value">${formatDate(test.rishum_rishon_dt) || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">××§×•×¨×™×•×ª</div>
                            <div class="info-value">${test.mkoriut_nm || '×œ× ×–××™×Ÿ'}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ×”×™×¡×˜×•×¨×™×™×ª ×‘×¢×œ×•×™×•×ª
        function formatOwnershipHistory(records) {
            if (!records || records.length === 0) {
                return '<div class="no-data">××™×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ×‘×¢×œ×•×™×•×ª ×–××™× ×”</div>';
            }

            const sorted = records.sort((a, b) => a.baalut_dt - b.baalut_dt);

            return sorted.map(record => {
                const dateStr = record.baalut_dt.toString();
                const year = dateStr.substring(0, 4);
                const month = dateStr.substring(4, 6);
                return `
                    <div class="history-item">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">×ª××¨×™×š ×‘×¢×œ×•×ª</div>
                                <div class="info-value">${month}/${year}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">×¡×•×’ ×‘×¢×œ×•×ª</div>
                                <div class="info-value">${record.baalut || '×œ× ×–××™×Ÿ'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘
        function formatDetailedTechnicalSpecs(specs) {
            if (!specs || specs.length === 0) {
                return '<div class="no-data">××™×Ÿ ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘ ×–××™×Ÿ</div>';
            }
            const spec = specs[0]; // ×§×‘×œ ××ª ×”×¨×©×•××” ×”×¨××©×•× ×”

            return `
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">×™×¦×¨×Ÿ</div>
                        <div class="info-value">${spec.tozeret_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×“×’×</div>
                        <div class="info-value">${spec.degem_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×©× ×ª ×™×™×¦×•×¨</div>
                        <div class="info-value">${spec.shnat_yitzur || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×¡×•×’ ×“×’×</div>
                        <div class="info-value">${spec.sug_degem || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¨×¥ ×™×™×¦×•×¨</div>
                        <div class="info-value">${spec.tozeret_eretz_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×¨××ª ×’×™××•×¨</div>
                        <div class="info-value">${spec.ramat_gimur || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">× ×¤×— ×× ×•×¢ (×¡×"×§)</div>
                        <div class="info-value">${spec.nefah_manoa || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×›×•×— ×¡×•×¡</div>
                        <div class="info-value">${spec.koah_sus || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××©×§×œ ×›×•×œ×œ</div>
                        <div class="info-value">${spec.mishkal_kolel || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¡×¤×¨ ×“×œ×ª×•×ª</div>
                        <div class="info-value">${spec.mispar_dlatot || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¡×¤×¨ ××•×©×‘×™×</div>
                        <div class="info-value">${spec.mispar_moshavim || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××–×’×Ÿ</div>
                        <div class="info-value">${spec.mazgan_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ABS</div>
                        <div class="info-value">${spec.abs_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×›×¨×™×•×ª ××•×•×™×¨</div>
                        <div class="info-value">${spec.mispar_kariot_avir || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×”×’×” ×›×•×—</div>
                        <div class="info-value">${spec.hege_koah_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×ª×™×‘×ª ×”×™×œ×•×›×™×</div>
                        <div class="info-value">${spec.automatic_ind ? '××•×˜×•××˜×™×ª' : '×™×“× ×™×ª'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×¡×•×’ ×ª×§× ×”</div>
                        <div class="info-value">${spec.sug_tkina_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×¡×•×’ ×××™×¨</div>
                        <div class="info-value">${spec.sug_mamir_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×˜×›× ×•×œ×•×’×™×™×ª ×”× ×¢×”</div>
                        <div class="info-value">${spec.technologiat_hanaa_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">CO2 (×’×¨×/×§"×)</div>
                        <div class="info-value">${spec.kamut_CO2 || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">NOX (×’×¨×/×§"×)</div>
                        <div class="info-value">${spec.kamut_NOX || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×§×‘×•×¦×ª ×–×™×”×•×</div>
                        <div class="info-value">${spec.kvutzat_zihum || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××“×“ ×™×¨×•×§</div>
                        <div class="info-value">${spec.madad_yarok || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×‘×§×¨×ª ×™×¦×™×‘×•×ª</div>
                        <div class="info-value">${spec.bakarat_yatzivut_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×›×•×©×¨ ×’×¨×™×¨×” ×¢× ×‘×œ××™×</div>
                        <div class="info-value">${spec.kosher_grira_im_blamim || '×œ× ×–××™×Ÿ'} ×§"×’</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×›×•×©×¨ ×’×¨×™×¨×” ×œ×œ× ×‘×œ××™×</div>
                        <div class="info-value">${spec.kosher_grira_bli_blamim || '×œ× ×–××™×Ÿ'} ×§"×’</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××§×•×¨ ×›×¨×™×•×ª ××•×•×™×¨</div>
                        <div class="info-value">${spec.kariot_avir_source || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×—×œ×•× ×•×ª ×—×©××œ</div>
                        <div class="info-value">${spec.mispar_halonot_hashmal || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×”× ×¢×”</div>
                        <div class="info-value">${spec.hanaa_nm || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¨×›×‘</div>
                        <div class="info-value">${spec.merkav || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×‘×§×¨×ª ×¡×˜×™×™×” ×× ×ª×™×‘</div>
                        <div class="info-value">${spec.bakarat_stiya_menativ_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">× ×™×˜×•×¨ ××¨×—×§ ××œ×¤× ×™×</div>
                        <div class="info-value">${spec.nitur_merhak_milfanim_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×–×™×”×•×™ ×‘×©×˜×— × ×¡×ª×¨</div>
                        <div class="info-value">${spec.zihuy_beshetah_nistar_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×‘×§×¨×ª ×©×™×•×˜ ××“×¤×˜×™×‘×™×ª</div>
                        <div class="info-value">${spec.bakarat_shyut_adaptivit_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×–×™×”×•×™ ×”×•×œ×›×™ ×¨×’×œ</div>
                        <div class="info-value">${spec.zihuy_holchey_regel_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¢×¨×›×ª ×¢×–×¨ ×œ×‘×œ×</div>
                        <div class="info-value">${spec.maarechet_ezer_labalam_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××¦×œ××ª ×¨×•×•×¨×¡</div>
                        <div class="info-value">${spec.matzlemat_reverse_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×—×™×™×©× ×™ ×œ×—×¥ ××•×•×™×¨ ×‘×¦××™×’×™×</div>
                        <div class="info-value">${spec.hayshaney_lahatz_avir_batzmigim_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×—×™×™×©× ×™ ×—×’×•×¨×•×ª</div>
                        <div class="info-value">${spec.hayshaney_hagorot_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">× ×™×§×•×“ ×‘×˜×™×—×•×ª</div>
                        <div class="info-value">${spec.nikud_betihut || '×œ× ×–××™×Ÿ'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×ª××•×¨×” ××•×˜×•××˜×™×ª</div>
                        <div class="info-value">${spec.teura_automatit_benesiya_kadima_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×©×œ×™×˜×” ××•×˜×•××˜×™×ª ×‘××•×¨×•×ª ×’×‘×•×”×™×</div>
                        <div class="info-value">${spec.shlita_automatit_beorot_gvohim_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×–×™×”×•×™ ××¦×‘ ×”×ª×§×¨×‘×•×ª ××¡×•×›× ×ª</div>
                        <div class="info-value">${spec.zihuy_matzav_hitkarvut_mesukenet_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×–×™×”×•×™ ×ª××¨×•×¨×™ ×ª× ×•×¢×”</div>
                        <div class="info-value">${spec.zihuy_tamrurey_tnua_ind ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×‘×§×¨×ª ×¡×˜×™×™×” ××§×˜×™×‘×™×ª</div>
                        <div class="info-value">${spec.bakarat_stiya_activ_s ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×‘×œ×™××” ××•×˜×•××˜×™×ª ×‘× ×¡×™×¢×” ×œ××—×•×¨</div>
                        <div class="info-value">${spec.blima_otomatit_nesia_leahor ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×‘×§×¨×ª ××”×™×¨×•×ª × ×¡×™×¢×”</div>
                        <div class="info-value">${spec.bakarat_mehirut_isa ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                     <div class="info-item">
                        <div class="info-label">×‘×œ×™××ª ×—×™×¨×•× ×œ×¤× ×™ ×”×•×œ×›×™ ×¨×’×œ ×•××•×¤× ×™×™×</div>
                        <div class="info-value">${spec.blimat_hirum_lifnei_holhei_regel_ofanaim ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">×”×ª× ×’×©×•×ª ×¦×“ ×‘×©×˜×— ××ª</div>
                        <div class="info-value">${spec.hitnagshut_cad_shetah_met ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">××œ×›×•-×œ×•×§</div>
                        <div class="info-value">${spec.alco_lock ? '×›×Ÿ' : '×œ×'}</div>
                    </div>
                </div>
            `;
        }

        // ×¤×•× ×§×¦×™×” ×¨××©×™×ª ×œ×—×™×¤×•×© ×¨×›×‘
        async function searchVehicle() {
            const vehicleNumber = document.getElementById('vehicleNumber').value;
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');

            if (!vehicleNumber) {
                alert('×× × ×”×›× ×¡ ××¡×¤×¨ ×¨×›×‘');
                return;
            }

            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';

            try {
                // ×©×œ×™×¤×ª × ×ª×•× ×™× ×‘×¡×™×¡×™×™× ×¢×œ ×”×¨×›×‘
                const vehicles = await fetchVehicleData(API_RESOURCES.vehicles, vehicleNumber);
                
                if (vehicles.length === 0) {
                    loadingDiv.style.display = 'none';
                    resultsDiv.innerHTML = '<div class="error">×œ× × ××¦× ×¨×›×‘ ×¢× ××¡×¤×¨ ×–×”</div>';
                    return;
                }

                const mainVehicleData = vehicles[0];

                // ×©×œ×™×¤×ª × ×ª×•× ×™× × ×•×¡×¤×™× ×‘××§×‘×™×œ
                const [disabilityTags, testHistory, ownershipHistory, detailedTechnicalSpecs] = await Promise.all([
                    fetchVehicleData(API_RESOURCES.disability_tags, vehicleNumber),
                    fetchVehicleData(API_RESOURCES.test_history, vehicleNumber),
                    fetchVehicleData(API_RESOURCES.ownership_history, vehicleNumber),
                    // ×©×œ×™×¤×ª ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘ ×‘×××¦×¢×•×ª ×¤×¨×˜×™ ×”×“×’×
                    fetchVehicleData(API_RESOURCES.detailed_technical_specs, {
                        degem_nm: mainVehicleData.degem_nm,
                        shnat_yitzur: String(mainVehicleData.shnat_yitzur), // ×”××¨×” ××¤×•×¨×©×ª ×œ××—×¨×•×–×ª
                        ramat_gimur: mainVehicleData.ramat_gimur
                    })
                ]);

                loadingDiv.style.display = 'none';

                // --- ×‘× ×™×™×ª ×¡×¢×™×£ ×”× ×ª×•× ×™× ×”×—×©×•×‘×™× ×œ××¢×œ×” ---
                const detailedTechnicalSpecsRecord = detailedTechnicalSpecs.length > 0 ? detailedTechnicalSpecs[0] : null;
                const testHistoryRecord = testHistory.length > 0 ? testHistory[0] : null;

                let keyInfoItemsHtml = '';

                // ××™×–×” ×™×“ (××¡×¤×¨ ×™×“)
                if (mainVehicleData.mispar_yad) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">×™×“</div>
                            <div class="key-info-value">${mainVehicleData.mispar_yad}</div>
                        </div>
                    `;
                }
                
                // ×›×•×— ×¡×•×¡
                if (detailedTechnicalSpecsRecord?.koah_sus) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">×›×•×— ×¡×•×¡</div>
                            <div class="key-info-value">${detailedTechnicalSpecsRecord.koah_sus}</div>
                        </div>
                    `;
                }

                // ×‘×¢×œ×•×ª ××§×•×¨×™×ª
                const originalOwnershipDate = formatDate(testHistoryRecord?.rishum_rishon_dt);
                const originalOwnershipType = testHistoryRecord?.mkoriut_nm;
                if (originalOwnershipDate || originalOwnershipType) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">×‘×¢×œ×•×ª ××§×•×¨×™×ª</div>
                            <div class="key-info-value">
                                ${originalOwnershipType ? originalOwnershipType : ''} 
                                ${originalOwnershipDate ? `(${originalOwnershipDate})` : ''}
                            </div>
                        </div>
                    `;
                }

                // ××•×¢×“ ×¢×œ×™×” ×œ×›×‘×™×©
                if (mainVehicleData.moed_aliya_lakvish) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">××•×¢×“ ×¢×œ×™×” ×œ×›×‘×™×©</div>
                            <div class="key-info-value">${mainVehicleData.moed_aliya_lakvish}</div>
                        </div>
                    `;
                }

                // × ×¤×— ×× ×•×¢
                if (detailedTechnicalSpecsRecord?.nefah_manoa) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">× ×¤×— ×× ×•×¢</div>
                            <div class="key-info-value">${detailedTechnicalSpecsRecord.nefah_manoa} ×¡×"×§</div>
                        </div>
                    `;
                }

                // ×§×™×œ×•××˜×¨××–'
                if (testHistoryRecord?.kilometer_test_aharon) {
                    keyInfoItemsHtml += `
                        <div class="key-info-item">
                            <div class="key-info-label">×§×™×œ×•××˜×¨××–' (××‘×—×Ÿ ××—×¨×•×Ÿ)</div>
                            <div class="key-info-value">${testHistoryRecord.kilometer_test_aharon.toLocaleString()} ×§"×</div>
                        </div>
                    `;
                }

                let keyInfoSectionHtml = '';
                if (keyInfoItemsHtml) {
                    keyInfoSectionHtml = `
                        <h2 class="section-title">âœ¨ × ×ª×•× ×™× ×—×©×•×‘×™×</h2>
                        <div class="key-info-section">
                            <div class="key-info-grid">
                                ${keyInfoItemsHtml}
                            </div>
                        </div>
                    `;
                }
                // --- ×¡×•×£ ×‘× ×™×™×ª ×¡×¢×™×£ ×”× ×ª×•× ×™× ×”×—×©×•×‘×™× ×œ××¢×œ×” ---

                // ×”×¦×’×ª ×”×ª×•×¦××•×ª
                let html = keyInfoSectionHtml; // ×”×ª×—×œ ×¢× ×”× ×ª×•× ×™× ×”×—×©×•×‘×™×
                html += '<h2 class="section-title">ğŸš— ×¤×¨×˜×™ ×”×¨×›×‘</h2>';
                html += formatVehicleInfo(mainVehicleData);

                html += '<h2 class="section-title">â™¿ ×ª×•×•×™ × ×›×•×ª</h2>';
                html += formatDisabilityTags(disabilityTags);

                html += '<h2 class="section-title">ğŸ“‹ ×”×™×¡×˜×•×¨×™×™×ª ××‘×—× ×™×</h2>';
                html += formatTestHistory(testHistory);

                html += '<h2 class="section-title">ğŸ‘¤ ×”×™×¡×˜×•×¨×™×™×ª ×‘×¢×œ×•×™×•×ª</h2>';
                html += formatOwnershipHistory(ownershipHistory);

                html += '<h2 class="section-title">âš™ï¸ ××¤×¨×˜ ×˜×›× ×™ ××•×¨×—×‘</h2>';
                html += formatDetailedTechnicalSpecs(detailedTechnicalSpecs);

                resultsDiv.innerHTML = html;

            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.innerHTML = '<div class="error">×©×’×™××” ×‘×—×™×¤×•×© ×”××™×“×¢. ×× × × ×¡×” ×©×•×‘.</div>';
            }
        }

        // ×”×•×¡×¤×ª ×”××–× ×” ×œ×§×œ×™×“ Enter
        document.getElementById('vehicleNumber').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVehicle();
            }
        });

        // ×˜×¢×™× ×ª ×“×•×’××” ×‘×”×ª×—×œ×”
        window.onload = function() {
            document.getElementById('vehicleNumber').value = '8767873';
        };
    </script>
</body>
</html>